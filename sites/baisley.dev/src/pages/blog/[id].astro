---
import { getCollection, render } from 'astro:content';
import MarkdownPostLayout from '../../layouts/MarkdownPostLayout.astro';


export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map(post => ({
    params: { id: post.id }, 
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

// Publish date and reading time estimation
const pubDate = post.data.publish_date ? new Date(post.data.publish_date) : null;
let readingTime = null;
if (typeof (post as any).body === 'string') {
  const words = (post as any).body.split(/\s+/).filter(Boolean).length;
  readingTime = Math.max(1, Math.ceil(words / 200));
}

console.log(`pubDate:`, pubDate);
---

<MarkdownPostLayout 
pageTitle={`Brett Baisley | Blog | ${post.data.title}`} 
title={post.data.title || ""}
subtitle={post.data.subtitle || ""}
publish_date={pubDate?.toISOString().slice(0, 10)}
author={post.data.author}
>

  <article class="prose max-w-none">
    <Content />
  </article>

</MarkdownPostLayout>